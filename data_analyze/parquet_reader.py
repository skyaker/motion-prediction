import pandas as pd
import os

df = pd.read_parquet("logs_output/il_logs.parquet")

log_file = "logs_output/pqt_summary.log"
os.makedirs(os.path.dirname(log_file), exist_ok=True)

with open(log_file, "w") as log:
    def log_print(text):
        """Функция для вывода в консоль и запись в лог-файл"""
        print(text)
        log.write(text + "\n")

    # --- 1. Общая информация о датасете ---
    log_print(f" Уникальных кадров в датасете: {df['frame_id'].nunique()} (количество временных шагов в выборке)")
    log_print(f" Всего записей (агентов): {len(df)} (сколько объектов наблюдается во всех кадрах)")

    # --- 2. Диапазоны координат ---
    log_print(f"\n Диапазон координат X: {df['x'].min():.2f} → {df['x'].max():.2f} (насколько широко распределены объекты по горизонтали)")
    log_print(f" Диапазон координат Y: {df['y'].min():.2f} → {df['y'].max():.2f} (разброс объектов по вертикали)")

    # --- 3. Описание скоростей ---
    log_print("\n Статистика по скоростям (vx, vy) – скорость движения агентов в метрах в секунду:")
    speed_stats = df[['vx', 'vy']].describe().to_string()
    log_print(speed_stats)

    log_print("\n Расшифровка статистики по скоростям:")
    log_print("   ➤ count: Сколько всего значений скорости записано (должно совпадать с количеством записей).")
    log_print("   ➤ mean: Средняя скорость по всем агентам. Если близка к нулю – большинство стоит.")
    log_print("   ➤ std: Стандартное отклонение – насколько скорости отличаются друг от друга.")
    log_print("   ➤ min/max: Минимальная и максимальная скорость (возможные границы).")
    log_print("   ➤ 25% / 50% / 75%: Квартильное распределение – сколько объектов стоит на месте.")

    # --- 4. Процент движущихся агентов ---
    moving_agents = df[(df["vx"] != 0) | (df["vy"] != 0)]
    moving_percentage = len(moving_agents) / len(df) * 100
    log_print(f"\n Процент агентов, которые двигаются: {moving_percentage:.2f}% (сколько объектов реально передвигается)")

    # --- 5. Пример первых n записей ---
    log_print("\n Пример первых 10 записей (координаты, скорости, ориентация):")
    log_print(df.head(10).to_string())